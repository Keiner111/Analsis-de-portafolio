import streamlit as st
import matplotlib.pyplot as plt
import pandas as pd
import numpy as np

def formato_pesos(val):
    """Formatea el numero con separador de miles como '.' y decimal como ','"""
    return f"${val:,.0f}".replace(",", "X").replace(".", ",").replace("X", ".")

def calcular_devaluacion(capital_productivo, ingreso_pasivo_mensual):
    st.markdown("""
    <div style='background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); 
                padding: 20px; border-radius: 15px; margin-bottom: 20px;'>
        <h2 style='color: white; text-align: center; margin: 0;'>
            üìä An√°lisis de Devaluaci√≥n e Inflaci√≥n + Crecimiento con Reinversi√≥n
        </h2>
    </div>
    """, unsafe_allow_html=True)

    # Obtener el capital total del DataFrame si est√° disponible
    capital_inicial_real = capital_productivo
    if 'df' in st.session_state and st.session_state.df is not None:
        df_temp = st.session_state.df.copy()
        df_temp['Dinero'] = df_temp['Dinero'].replace('[\$,]', '', regex=True).astype(float)
        capital_inicial_real = df_temp['Dinero'].sum()

    # Mostrar informaci√≥n del capital con dise√±o mejorado y colores
    st.markdown("""
    <div style='background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%); 
                padding: 15px; border-radius: 10px; margin-bottom: 20px;'>
        <h4 style='color: white; text-align: center; margin: 0;'>
            üíº Informaci√≥n del Portafolio
        </h4>
    </div>
    """, unsafe_allow_html=True)
    
    col_info1, col_info2, col_info3 = st.columns(3)
    with col_info1:
        st.metric("üí∞ Capital Total", formato_pesos(capital_inicial_real))
    with col_info2:
        st.metric("üè¶ Capital Productivo", formato_pesos(capital_productivo))
    with col_info3:
        st.metric("üíµ Ingreso Mensual", formato_pesos(ingreso_pasivo_mensual))

    st.markdown("---")

    # Inicializar variables en st.session_state si no existen
    if "inflacion_anual_input" not in st.session_state:
        st.session_state.inflacion_anual_input = 3.0
    if "anios_input" not in st.session_state:
        st.session_state.anios_input = 2
    if "rentabilidad_mensual_input" not in st.session_state:
        st.session_state.rentabilidad_mensual_input = 1.79

    # Crear columnas para mejor organizaci√≥n
    st.markdown("""
    <div style='background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%); 
                padding: 15px; border-radius: 10px; margin: 20px 0;'>
        <h4 style='color: white; text-align: center; margin: 0;'>
            ‚öôÔ∏è Configuraci√≥n del An√°lisis
        </h4>
    </div>
    """, unsafe_allow_html=True)
    
    col1, col2 = st.columns(2)
    
    with col1:
        st.markdown("""
        <div style='background-color: #e3f2fd; padding: 12px; border-radius: 8px; border-left: 5px solid #2196f3;'>
            <strong style='font-size: 1.1em; color: #1565c0;'>üìÖ Par√°metros de Inflaci√≥n y Tiempo</strong>
        </div>
        """, unsafe_allow_html=True)
        st.markdown("<br>", unsafe_allow_html=True)
        # Entrada de usuario
        inflacion_anual = st.number_input(
            "Inflaci√≥n anual estimada (%)",
            min_value=0.0,
            max_value=50.0,
            value=st.session_state.inflacion_anual_input,
            step=0.01,
            format="%.2f",
            key="inflacion_anual_key",
            help="Inflaci√≥n anual esperada en Colombia (hist√≥rico: 3-10%)"
        )
        st.session_state.inflacion_anual_input = inflacion_anual

        anios = st.slider(
            "Per√≠odo de an√°lisis (a√±os)",
            min_value=1,
            max_value=20,
            value=st.session_state.anios_input,
            key="anios_key",
            help="Tiempo de proyecci√≥n del an√°lisis"
        )
        st.session_state.anios_input = anios

    with col2:
        st.markdown("""
        <div style='background-color: #f3e5f5; padding: 12px; border-radius: 8px; border-left: 5px solid #9c27b0;'>
            <strong style='font-size: 1.1em; color: #6a1b9a;'>üíé Par√°metros de Rentabilidad y Reinversi√≥n</strong>
        </div>
        """, unsafe_allow_html=True)
        st.markdown("<br>", unsafe_allow_html=True)
        # Rentabilidad mensual estimada
        rentabilidad_mensual_simulacion = st.number_input(
            "Rentabilidad mensual estimada (%)",
            min_value=0.0,
            max_value=20.0,
            value=st.session_state.rentabilidad_mensual_input,
            step=0.01,
            format="%.2f",
            key="rentabilidad_mensual_key",
            help="Rendimiento mensual esperado de tu inversi√≥n"
        ) / 100
        st.session_state.rentabilidad_mensual_input = rentabilidad_mensual_simulacion * 100

        # Reinversi√≥n con informaci√≥n clara
        porcentaje_reinversion_pct = st.slider(
            "Porcentaje de ganancias a reinvertir (%)",
            min_value=0,
            max_value=100,
            value=100,
            step=5,
            help="¬øQu√© porcentaje de las ganancias reinviertes?"
        )
        
        valor_reinversion = (ingreso_pasivo_mensual * porcentaje_reinversion_pct) / 100
        valor_retiro = ingreso_pasivo_mensual - valor_reinversion
        
        col_r1, col_r2 = st.columns(2)
        with col_r1:
            st.success(f"**‚Üª Reinversi√≥n:** {formato_pesos(valor_reinversion)}")
        with col_r2:
            st.info(f"**‚Üì Retiro:** {formato_pesos(valor_retiro)}")
        
        porcentaje_reinversion = porcentaje_reinversion_pct / 100

    # Selecci√≥n del capital a analizar
    st.markdown("---")
    usar_capital_total = st.radio(
        "üíº ¬øQu√© capital deseas usar para el an√°lisis?",
        options=[
            f"Capital Total ({formato_pesos(capital_inicial_real)})",
            f"Solo Capital Productivo ({formato_pesos(capital_productivo)})"
        ],
        help="El capital total incluye todas tus inversiones. El capital productivo solo las que generan intereses mensuales.",
        horizontal=True
    )
    
    capital_para_analisis = capital_inicial_real if "Total" in usar_capital_total else capital_productivo

    if inflacion_anual == 0:
        st.warning("‚ö†Ô∏è Por favor, ingresa un valor de inflaci√≥n mayor a 0 para continuar.")
        return

    # C√°lculos
    meses = anios * 12
    inflacion_mensual = inflacion_anual / 12 / 100

    # Simulaci√≥n sin inversi√≥n
    poder_adquisitivo = []
    capital_ajustado = capital_para_analisis
    for mes in range(meses + 1):
        poder_adquisitivo.append(capital_ajustado)
        capital_ajustado /= (1 + inflacion_mensual)

    # Simulaci√≥n con reinversi√≥n
    crecimiento_real = []
    capital_real = capital_para_analisis
    ingresos_acumulados = []
    ingreso_acumulado = 0
    
    for mes in range(meses + 1):
        crecimiento_real.append(capital_real)
        if mes > 0:
            ingreso_real = ingreso_pasivo_mensual * ((1 + inflacion_mensual) ** -mes)
            ingreso_acumulado += ingreso_real
            capital_real += ingreso_real * porcentaje_reinversion
            capital_real *= (1 + rentabilidad_mensual_simulacion)
            capital_real /= (1 + inflacion_mensual)
        ingresos_acumulados.append(ingreso_acumulado)

    # Escenarios de rentabilidad
    escenarios = {
        "Conservador": rentabilidad_mensual_simulacion * 0.7,
        "Base": rentabilidad_mensual_simulacion,
        "Optimista": rentabilidad_mensual_simulacion * 1.3
    }
    
    escenarios_data = {}
    for nombre, rentabilidad in escenarios.items():
        capital_escenario = capital_para_analisis
        valores_escenario = []
        for mes in range(meses + 1):
            valores_escenario.append(capital_escenario)
            if mes > 0:
                ingreso_real = ingreso_pasivo_mensual * ((1 + inflacion_mensual) ** -mes)
                capital_escenario += ingreso_real * porcentaje_reinversion
                capital_escenario *= (1 + rentabilidad)
                capital_escenario /= (1 + inflacion_mensual)
        escenarios_data[nombre] = valores_escenario

    # Resultados principales
    st.markdown("---")
    st.markdown("""
    <div style='background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%); 
                padding: 15px; border-radius: 10px; margin: 20px 0;'>
        <h4 style='color: white; text-align: center; margin: 0;'>
            üìà Resultados del An√°lisis
        </h4>
    </div>
    """, unsafe_allow_html=True)
    
    col1, col2, col3, col4 = st.columns(4)
    
    with col1:
        st.metric("üíº Capital Inicial", formato_pesos(capital_para_analisis))
    
    with col2:
        perdida_valor = capital_para_analisis - poder_adquisitivo[-1]
        perdida_pct = (perdida_valor / capital_para_analisis) * 100
        st.metric(
            "üìâ Sin Inversi√≥n", 
            formato_pesos(poder_adquisitivo[-1]),
            f"-{perdida_pct:.1f}%",
            delta_color="inverse"
        )
    
    with col3:
        ganancia_real = crecimiento_real[-1] - capital_para_analisis
        ganancia_pct = (ganancia_real / capital_para_analisis) * 100
        st.metric(
            "üìä Con Reinversi√≥n", 
            formato_pesos(crecimiento_real[-1]),
            f"+{ganancia_pct:.1f}%"
        )
    
    with col4:
        diferencia = crecimiento_real[-1] - poder_adquisitivo[-1]
        st.metric(
            "‚ú® Ganancia vs Inflaci√≥n", 
            formato_pesos(diferencia),
            f"+{((diferencia / poder_adquisitivo[-1]) * 100):.1f}%"
        )

    # Gr√°fico principal mejorado
    st.markdown("---")
    st.markdown("""
    <div style='background: linear-gradient(135deg, #a8edea 0%, #fed6e3 100%); 
                padding: 15px; border-radius: 10px; margin: 20px 0;'>
        <h4 style='color: #333; text-align: center; margin: 0;'>
            üìâ Evoluci√≥n del Capital en T√©rminos Reales
        </h4>
    </div>
    """, unsafe_allow_html=True)
    
    fig, ax = plt.subplots(figsize=(14, 7))
    meses_x = list(range(meses + 1))

    # L√≠nea de inflaci√≥n
    ax.plot(meses_x, poder_adquisitivo, label="Sin inversi√≥n (solo inflaci√≥n)", 
            color="#e74c3c", linewidth=2.5, alpha=0.85, linestyle='--')
    
    # Escenarios de inversi√≥n
    colors = {'Conservador': '#f39c12', 'Base': '#27ae60', 'Optimista': '#3498db'}
    for nombre, valores in escenarios_data.items():
        alpha = 1.0 if nombre == "Base" else 0.65
        linewidth = 3.5 if nombre == "Base" else 2.2
        ax.plot(meses_x, valores, 
                label=f"{nombre} ({escenarios[nombre]*100:.2f}% mensual)", 
                color=colors[nombre], linewidth=linewidth, alpha=alpha)

    ax.set_title("Evoluci√≥n del Poder Adquisitivo vs Inversi√≥n (COP)", 
                 fontsize=16, fontweight='bold', pad=20)
    ax.set_xlabel("Meses", fontsize=13, fontweight='bold')
    ax.set_ylabel("Valor en Pesos Colombianos", fontsize=13, fontweight='bold')
    ax.legend(loc='upper left', fontsize=11, framealpha=0.95)
    ax.grid(True, alpha=0.3, linestyle='--')
    ax.get_yaxis().set_major_formatter(
        plt.FuncFormatter(lambda x, _: f"${int(x):,}".replace(",", "."))
    )
    
    # √Årea sombreada de ganancia
    ax.fill_between(meses_x, poder_adquisitivo, escenarios_data["Base"], 
                    alpha=0.15, color='#27ae60')
    
    plt.tight_layout()
    st.pyplot(fig)

    # Explicaci√≥n de la gr√°fica
    st.markdown("""
    <div style='background-color: #e8eaf6; padding: 20px; border-radius: 10px; border-left: 5px solid #3f51b5; margin-top: 20px;'>
        <strong style='font-size: 1.2em; color: #1a237e;'>üìñ C√≥mo interpretar esta gr√°fica:</strong>
    </div>
    """, unsafe_allow_html=True)
    
    st.markdown("")
    
    col_exp1, col_exp2 = st.columns([1, 1])
    
    with col_exp1:
        st.markdown("""
        <div style='background-color: #ffebee; padding: 15px; border-radius: 8px; margin-bottom: 15px;'>
            <strong style='color: #c62828; font-size: 1.05em;'>üî¥ L√≠nea roja punteada (Sin inversi√≥n):</strong><br>
            <span style='color: #333; font-weight: 500;'>
            Muestra c√≥mo tu dinero pierde valor con el tiempo debido a la inflaci√≥n. 
            Si solo guardas el dinero sin invertirlo, cada mes compra menos cosas.
            </span>
        </div>
        """, unsafe_allow_html=True)
        
        st.markdown("""
        <div style='background-color: #fff3e0; padding: 15px; border-radius: 8px; margin-bottom: 15px;'>
            <strong style='color: #e65100; font-size: 1.05em;'>üü† L√≠nea naranja (Escenario Conservador):</strong><br>
            <span style='color: #333; font-weight: 500;'>
            Proyecci√≥n con una rentabilidad 30% menor a la estimada. 
            Representa un escenario pesimista o de bajo rendimiento.
            </span>
        </div>
        """, unsafe_allow_html=True)
        
        st.markdown("""
        <div style='background-color: #e8f5e9; padding: 15px; border-radius: 8px; margin-bottom: 15px;'>
            <strong style='color: #2e7d32; font-size: 1.05em;'>üü¢ L√≠nea verde (Escenario Base):</strong><br>
            <span style='color: #333; font-weight: 500;'>
            Tu proyecci√≥n principal basada en la rentabilidad que ingresaste. 
            Esta es la l√≠nea m√°s importante y realista seg√∫n tus par√°metros.
            </span>
        </div>
        """, unsafe_allow_html=True)
    
    with col_exp2:
        st.markdown("""
        <div style='background-color: #e3f2fd; padding: 15px; border-radius: 8px; margin-bottom: 15px;'>
            <strong style='color: #01579b; font-size: 1.05em;'>üîµ L√≠nea azul (Escenario Optimista):</strong><br>
            <span style='color: #333; font-weight: 500;'>
            Proyecci√≥n con una rentabilidad 30% mayor a la estimada. 
            Representa el mejor escenario posible.
            </span>
        </div>
        """, unsafe_allow_html=True)
        
        st.markdown("""
        <div style='background-color: #f1f8e9; padding: 15px; border-radius: 8px; margin-bottom: 15px;'>
            <strong style='color: #33691e; font-size: 1.05em;'>üíö √Årea sombreada verde:</strong><br>
            <span style='color: #333; font-weight: 500;'>
            Representa la ganancia que obtienes al invertir con reinversi√≥n vs. no hacer nada. 
            Mientras m√°s grande sea esta √°rea, mejor est√° funcionando tu estrategia.
            </span>
        </div>
        """, unsafe_allow_html=True)
        
        st.markdown("""
        <div style='background-color: #ede7f6; padding: 15px; border-radius: 8px; margin-bottom: 15px;'>
            <strong style='color: #4527a0; font-size: 1.05em;'>üí° Conclusi√≥n:</strong><br>
            <span style='color: #333; font-weight: 500;'>
            Si las l√≠neas de inversi√≥n est√°n por encima de la l√≠nea roja, 
            significa que est√°s gan√°ndole a la inflaci√≥n y tu dinero est√° creciendo en t√©rminos reales.
            </span>
        </div>
        """, unsafe_allow_html=True)

    # Tabla detallada
    st.markdown("---")
    with st.expander("üìã Ver proyecci√≥n detallada por a√±os", expanded=False):
        anos_data = []
        for ano in range(1, anios + 1):
            mes_idx = ano * 12
            anos_data.append({
                "A√±o": ano,
                "Sin Inversi√≥n": formato_pesos(poder_adquisitivo[mes_idx]),
                "Conservador": formato_pesos(escenarios_data["Conservador"][mes_idx]),
                "Base": formato_pesos(escenarios_data["Base"][mes_idx]),
                "Optimista": formato_pesos(escenarios_data["Optimista"][mes_idx])
            })
        
        df_proyeccion = pd.DataFrame(anos_data)
        st.dataframe(df_proyeccion, use_container_width=True, hide_index=True)

    # An√°lisis de rentabilidad
    st.markdown("---")
    st.markdown("""
    <div style='background: linear-gradient(135deg, #ffecd2 0%, #fcb69f 100%); 
                padding: 15px; border-radius: 10px; margin: 20px 0;'>
        <h4 style='color: #333; text-align: center; margin: 0;'>
            üí° An√°lisis de Rentabilidad
        </h4>
    </div>
    """, unsafe_allow_html=True)
    
    col1, col2 = st.columns(2)
    
    with col1:
        st.markdown("""
        <div style='background-color: #4ca699; padding: 12px; border-radius: 8px; border-left: 4px solid #4caf50; margin-bottom: 15px;'>
            <strong>üìä Rendimientos mensuales</strong>
        </div>
        """, unsafe_allow_html=True)
        
        rentabilidad_real_mensual = (ingreso_pasivo_mensual / capital_para_analisis * 100) if capital_para_analisis > 0 else 0
        inflacion_mensual_pct = inflacion_mensual * 100
        st.markdown(f"""
        <div style='color: #1b5e20; font-weight: 500; margin-top: 10px;'>
        ‚Ä¢ Tu portafolio: <strong style='font-size: 1.1em;'>{rentabilidad_real_mensual:.2f}%</strong><br>
        ‚Ä¢ Inflaci√≥n: <strong style='font-size: 1.1em;'>{inflacion_mensual_pct:.2f}%</strong><br>
        ‚Ä¢ Rentabilidad real: <strong style='font-size: 1.1em;'>{rentabilidad_real_mensual - inflacion_mensual_pct:.2f}%</strong>
        </div>
        """, unsafe_allow_html=True)
        
        rentabilidad_anual_nominal = rentabilidad_real_mensual * 12
        rentabilidad_anual_real = rentabilidad_anual_nominal - inflacion_anual
        
        st.markdown("""
        <div style='background-color: #fff3e0; padding: 12px; border-radius: 8px; border-left: 5px solid #ff9800; margin-top: 15px;'>
            <strong style='font-size: 1.1em; color: #e65100;'>üìÖ Rendimientos anuales equivalentes</strong>
        </div>
        """, unsafe_allow_html=True)
        st.markdown(f"""
        <div style='color: #bf360c; font-weight: 500; margin-top: 10px;'>
        ‚Ä¢ Nominal: <strong style='font-size: 1.1em;'>{rentabilidad_anual_nominal:.2f}%</strong><br>
        ‚Ä¢ Real (descontando inflaci√≥n): <strong style='font-size: 1.1em;'>{rentabilidad_anual_real:.2f}%</strong>
        </div>
        """, unsafe_allow_html=True)
    
    with col2:
        st.markdown("""
        <div style='background-color: #e1f5fe; padding: 12px; border-radius: 8px; border-left: 5px solid #03a9f4; margin-bottom: 15px;'>
            <strong style='font-size: 1.1em; color: #01579b;'>üéØ Evaluaci√≥n de tu estrategia</strong>
        </div>
        """, unsafe_allow_html=True)
        if rentabilidad_real_mensual > inflacion_mensual_pct * 1.5:
            st.success("‚úÖ **Excelente:** Est√°s superando significativamente la inflaci√≥n. Tu estrategia es muy efectiva.")
        elif rentabilidad_real_mensual > inflacion_mensual_pct:
            st.success("‚úÖ **Bien:** Est√°s creciendo tu dinero m√°s r√°pido que la inflaci√≥n, lo cual es positivo.")
        elif rentabilidad_real_mensual == inflacion_mensual_pct:
            st.info("‚ÑπÔ∏è **Neutro:** Tu crecimiento compensa la inflaci√≥n. Mantienes el poder adquisitivo.")
        else:
            st.warning("‚ö†Ô∏è **Atenci√≥n:** Tus rendimientos est√°n por debajo de la inflaci√≥n. Considera optimizar tu estrategia.")

    # Recomendaciones
    st.markdown("---")
    st.markdown("""
    <div style='background: linear-gradient(135deg, #84fab0 0%, #8fd3f4 100%); 
                padding: 15px; border-radius: 10px; margin: 20px 0;'>
        <h4 style='color: white; text-align: center; margin: 0;'>
            üí° Recomendaciones Personalizadas
        </h4>
    </div>
    """, unsafe_allow_html=True)
    
    if rentabilidad_real_mensual < inflacion_mensual_pct:
        st.markdown("""
        <div style='background-color: #fff3e0; padding: 15px; border-radius: 8px; border-left: 5px solid #ff9800;'>
            <strong style='font-size: 1.1em; color: #e65100;'>üîç Para mejorar tu situaci√≥n:</strong><br><br>
            <span style='color: #333; font-weight: 500;'>
            üéØ Busca inversiones con mayor rentabilidad<br>
            üåê Considera diversificar tu portafolio<br>
            üìà Eval√∫a opciones como fondos indexados, acciones o bienes ra√≠ces<br>
            üí∞ Aumenta el porcentaje de reinversi√≥n si es posible<br>
            üìö Educa tu conocimiento financiero para mejores decisiones
            </span>
        </div>
        """, unsafe_allow_html=True)
    else:
        st.markdown("""
        <div style='background-color: #e8f5e9; padding: 15px; border-radius: 8px; border-left: 5px solid #4caf50;'>
            <strong style='font-size: 1.1em; color: #2e7d32;'>üéâ Para mantener y mejorar:</strong><br><br>
            <span style='color: #333; font-weight: 500;'>
            ‚úÖ Mant√©n la disciplina de reinversi√≥n<br>
            üí™ Considera aumentar aportes mensuales si es posible<br>
            üîÑ Revisa peri√≥dicamente el desempe√±o vs inflaci√≥n<br>
            üåü Diversifica para reducir riesgos<br>
            üìä Registra tus avances y celebra tus logros
            </span>
        </div>
        """, unsafe_allow_html=True)

def main():
    st.set_page_config(
        page_title="An√°lisis Financiero - Inflaci√≥n e Inversiones",
        page_icon="üí∞",
        layout="wide",
        initial_sidebar_state="expanded"
    )
    
    st.markdown("""
    <div style='background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); 
                padding: 20px; border-radius: 15px; margin-bottom: 20px;'>
        <h1 style='color: white; text-align: center; margin: 0;'>
            üí∞ An√°lisis Financiero: Inflaci√≥n e Inversiones
        </h1>
        <p style='color: #e0e0e0; text-align: center; margin: 10px 0 0 0; font-size: 1.1em;'>
            Herramienta para proyectar el impacto de la inflaci√≥n y estrategias de inversi√≥n
        </p>
    </div>
    """, unsafe_allow_html=True)
    st.markdown("---")
    
    # Sidebar mejorado
    with st.sidebar:
        st.markdown("""
        <div style='background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%); 
                    padding: 15px; border-radius: 10px; margin-bottom: 20px;'>
            <h3 style='color: white; text-align: center; margin: 0;'>
                ‚öôÔ∏è Par√°metros del Portafolio
            </h3>
        </div>
        """, unsafe_allow_html=True)
        st.markdown("Configura los valores iniciales de tu inversi√≥n")
        
        capital_productivo = st.number_input(
            "üíµ Capital productivo inicial (COP)",
            min_value=100000,
            value=10000000,
            step=100000,
            format="%d",
            help="Tu capital inicial que genera ingresos"
        )
        
        ingreso_pasivo_mensual = st.number_input(
            "üí∏ Ingreso pasivo mensual (COP)",
            min_value=1000,
            value=150000,
            step=1000,
            format="%d",
            help="Ingresos mensuales generados por tu capital"
        )
        
        st.markdown("---")
        
        if capital_productivo > 0:
            rentabilidad_actual = (ingreso_pasivo_mensual / capital_productivo) * 100
            st.markdown(f"""
            <div style='background-color: #e8f5e9; padding: 15px; border-radius: 10px; border-left: 5px solid #4caf50;'>
                <strong style='color: #2e7d32;'>üìä Rentabilidad actual:</strong><br>
                <span style='color: #1b5e20;'>‚Ä¢ Mensual: <strong>{rentabilidad_actual:.2f}%</strong></span><br>
                <span style='color: #1b5e20;'>‚Ä¢ Anual: <strong>~{rentabilidad_actual * 12:.1f}%</strong></span>
            </div>
            """, unsafe_allow_html=True)
        
        st.markdown("---")
        st.markdown("""
        <div style='background-color: #fff3e0; padding: 15px; border-radius: 8px; border-left: 5px solid #ff9800;'>
            <strong style='font-size: 1.05em; color: #e65100;'>üí° Tip:</strong> 
            <span style='color: #333; font-weight: 500;'>Ajusta los par√°metros en la secci√≥n principal para explorar diferentes escenarios.</span>
        </div>
        """, unsafe_allow_html=True)
    
    # Ejecutar an√°lisis principal
    calcular_devaluacion(capital_productivo, ingreso_pasivo_mensual)
    
    # Footer
    st.markdown("---")
    st.markdown("""
    <div style='background: linear-gradient(135deg, #e0c3fc 0%, #8ec5fc 100%); 
                padding: 25px; border-radius: 10px; text-align: center;'>
        <p style='color: #1a237e; margin: 8px 0; font-size: 1.1em; font-weight: 600;'>
            üìå Recuerda: Los resultados son proyecciones basadas en los par√°metros ingresados.
        </p>
        <p style='color: #283593; margin: 8px 0; font-size: 1em; font-weight: 500;'>
            Consulta con un asesor financiero para decisiones de inversi√≥n importantes.
        </p>
    </div>
    """, unsafe_allow_html=True)

if __name__ == "__main__":
    # Inicializar session_state.df si no existe
    if 'df' not in st.session_state:
        st.session_state.df = None
    main()